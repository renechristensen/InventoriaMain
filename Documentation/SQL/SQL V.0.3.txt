//Changes in version 0.3. Added hashingpassword and hashingsalt to users table, with Binary 64

/* Create Inventoria database and start using it */
CREATE DATABASE IF NOT EXISTS Inventoria;
USE Inventoria;

/* Create database users */
CREATE USER IF NOT EXISTS 'inventarioUser'@'localhost' IDENTIFIED BY 'ha32iixs_';
GRANT ALL PRIVILEGES ON inventoria.* TO 'inventarioUser'@'localhost';
FLUSH PRIVILEGES;


/* Company table */
CREATE TABLE IF NOT EXISTS Company (
  CompanyID INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  Name VARCHAR(255) NOT NULL,
  Description TEXT
);

/* DataCenter table */
CREATE TABLE IF NOT EXISTS DataCenter (
  DataCenterID INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  Name VARCHAR(255) NOT NULL,
  Address VARCHAR(255) NOT NULL,
  Description TEXT,
  CompanyID INT,
  FOREIGN KEY (CompanyID) REFERENCES Company(CompanyID)
);

/* ServerRoom table */
CREATE TABLE IF NOT EXISTS ServerRoom (
  ServerRoomID INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  DataCenterID INT NOT NULL,
  ServerRoomName VARCHAR(255) NOT NULL,
  RackCapacity INT NOT NULL,
  StartupDate DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (DataCenterID) REFERENCES DataCenter(DataCenterID)
);

/* DataRacks table */
CREATE TABLE IF NOT EXISTS DataRacks (
  DataRackID INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  ServerRoomID INT NOT NULL,
  RackPlacement TEXT NOT NULL,
  TotalUnits INT NOT NULL,
  AvailableUnits INT NOT NULL,
  Status ENUM('Active', 'Inactive', 'Maintenance', 'Decommissioned') NOT NULL,
  CreationDate DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (ServerRoomID) REFERENCES ServerRoom(ServerRoomID)
);

/* RackUnits table */
CREATE TABLE IF NOT EXISTS RackUnits (
  RackUnitID INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  DataRackID INT NOT NULL,
  UnitNumber INT NOT NULL,
  FOREIGN KEY (DataRackID) REFERENCES DataRacks(DataRackID)
);

/* Users table */
CREATE TABLE IF NOT EXISTS Users (
  UserID INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  Displayname VARCHAR(255) NOT NULL,
  PasswordHash BINARY(64) NOT NULL,
  PasswordSalt BINARY(64) NOT NULL,
  StudieEmail VARCHAR(255) NOT NULL,
  CreationDate DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  LastLoginDate DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  CompanyID INT,
  FOREIGN KEY (CompanyID) REFERENCES Company(CompanyID)
);

/* Roles table */
CREATE TABLE IF NOT EXISTS Roles (
  RoleID INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  RoleName VARCHAR(255) NOT NULL
);

/* UserRole junction table */
CREATE TABLE IF NOT EXISTS UserRole (
  UserRoleID INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  UserID INT NOT NULL,
  RoleID INT NOT NULL,
  FOREIGN KEY (UserID) REFERENCES Users(UserID),
  FOREIGN KEY (RoleID) REFERENCES Roles(RoleID)
);

/* Reservations table */
CREATE TABLE IF NOT EXISTS Reservations (
  ReservationID INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  UserID INT NOT NULL,
  StartDate DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  EndDate DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  Background TEXT NOT NULL,
  FOREIGN KEY (UserID) REFERENCES Users(UserID)
);

/* ReservedRackUnit table */
CREATE TABLE IF NOT EXISTS ReservedRackUnit (
  ReservedRackUnitID INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  ReservationID INT NOT NULL,
  RackUnitID INT NOT NULL,
  FOREIGN KEY (ReservationID) REFERENCES Reservations(ReservationID),
  FOREIGN KEY (RackUnitID) REFERENCES RackUnits(RackUnitID)
);

/* Equipment table */
CREATE TABLE IF NOT EXISTS Equipment (
  EquipmentID INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  Name VARCHAR(255) NOT NULL,
  Model VARCHAR(255) NOT NULL,
  Type VARCHAR(255) NOT NULL
);

/* EquipmentRackUnits table */
CREATE TABLE IF NOT EXISTS EquipmentRackUnits (
  EquipmentRackUnitID INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  EquipmentID INT NOT NULL,
  RackUnitID INT NOT NULL,
  FOREIGN KEY (EquipmentID) REFERENCES Equipment(EquipmentID),
  FOREIGN KEY (RackUnitID) REFERENCES RackUnits(RackUnitID)
);

/* EnvironmentalReadings table */
CREATE TABLE IF NOT EXISTS EnvironmentalReadings (
  EnvironmentalReadingID INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  Temperature FLOAT NOT NULL,
  Humidity FLOAT NOT NULL,
  ReadingTimestamp DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP
);

/* EnvironmentalSettings table */
CREATE TABLE IF NOT EXISTS EnvironmentalSettings (
  EnvironmentalSettingsID INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  ServerRoomID INT NOT NULL,
  TemperatureUpperLimit FLOAT NOT NULL,
  TemperatureLowerLimit FLOAT NOT NULL,
  HumidityUpperLimit FLOAT NOT NULL,
  HumidityLowerLimit FLOAT NOT NULL,
  LatestChange TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (ServerRoomID) REFERENCES ServerRoom(ServerRoomID)
);

/* AlertTypes table */
CREATE TABLE IF NOT EXISTS AlertTypes (
  AlertTypeID INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  TypeName VARCHAR(255) NOT NULL,
  Description TEXT
);

/* Alerts table */
CREATE TABLE IF NOT EXISTS Alerts (
  AlertID INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  AlertTypeID INT NOT NULL,
  ThresholdExceeded BOOL NOT NULL,
  EnvironmentalReadingID INT NOT NULL,
  AlertTimestamp DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  Resolved BOOL NOT NULL,
  FOREIGN KEY (AlertTypeID) REFERENCES AlertTypes(AlertTypeID),
  FOREIGN KEY (EnvironmentalReadingID) REFERENCES EnvironmentalReadings(EnvironmentalReadingID)
);

/* RackAccessPermissions table */
CREATE TABLE IF NOT EXISTS RackAccessPermissions (
  RackAccessPermissionID INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  DataRackID INT NOT NULL,
  RoleID INT NOT NULL,
  FOREIGN KEY (DataRackID) REFERENCES DataRacks(DataRackID),
  FOREIGN KEY (RoleID) REFERENCES Roles(RoleID)
);

/* UserChangeLog table */
CREATE TABLE IF NOT EXISTS UserChangeLog (
  UserChangeLogID INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  UserID INT NOT NULL,
  ChangedByUserID INT NOT NULL,
  ChangeType VARCHAR(255) NOT NULL,
  ChangeTimestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  ChangeDescription TEXT,
  FOREIGN KEY (UserID) REFERENCES Users(UserID),
  FOREIGN KEY (ChangedByUserID) REFERENCES Users(UserID)
);

/* DataRacksChangeLog table */
CREATE TABLE IF NOT EXISTS DataRacksChangeLog (
  DataRacksChangeLogID INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  DataRackID INT NOT NULL,
  ChangedByUserID INT NOT NULL,
  ChangeType VARCHAR(255) NOT NULL,
  ChangeTimestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  ChangeDescription TEXT,
  FOREIGN KEY (DataRackID) REFERENCES DataRacks(DataRackID),
  FOREIGN KEY (ChangedByUserID) REFERENCES Users(UserID)
);